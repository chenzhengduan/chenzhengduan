name: GitHub-Profile-3D-Contrib

on:
  schedule: # 03:00 JST == 18:00 UTC
    - cron: "0 2 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    name: generate-github-profile-3d-contrib
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - uses: yoshi389111/github-profile-3d-contrib@0.7.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          USERNAME: ${{ github.repository_owner }}
      - name: Commit & Push
        run: |
          git config user.name chenzhengduan
          git config user.email code.duan@gmail.com
          git add -A .
          git commit -m "generated"
          git push
          
      # 发送消息到企业微信机器人
      - name: Send message to WeChat Work
        run: |
          sudo apt-get install -y nodejs npm  # 安装 node 和 npm
          npm install node-fetch@2            # 安装 node-fetch v2
          node -e "
            const fetch = require('node-fetch');
            const webhookUrl = 'http://111.230.107.130:8005/tansci/auth/webhook?key=2abc957c-2501-4467-9220-6efc5f12228e';
            const message = {
              msgtype: 'text',
              text: {
                content: '来自github:更新成功',
              }
            };
            fetch(webhookUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(message)
            })
            .then(response => response.json())
            .then(data => {
              if (data.errcode === 0) {
                console.log('消息发送成功');
              } else {
                console.log('消息发送失败', data);
              }
            })
            .catch(error => {
              console.error('请求失败', error);
            });
          "
